<mat-drawer-container class="example-container" hasBackdrop="false">
    <mat-drawer #drawerActivities mode="side" position="end" style="padding-left: 15px; margin-right: 15px;">
        <mat-card>
            <mat-toolbar>

                <span>Beneficiary Activities</span>
                <span class="spacer"></span>
                <button mat-icon-button (click)="closeDrawerActivities()">
                    <mat-icon>close</mat-icon>
                </button>

            </mat-toolbar>
            <div>
                <br>
                <h3>
                    Activities Information
                </h3>
                <p>
                    Beneficiary ID: {{ drawer_beneficiary.id }}
                </p>
                <p>
                    Name:
                    {{ drawer_beneficiary.ben_first_name + ' ' + drawer_beneficiary.ben_middle_name + ' ' + drawer_beneficiary.ben_last_name1  + ' ' + drawer_beneficiary.ben_last_name2}}
                </p>
            </div>

            <mat-divider></mat-divider>

            <mat-list>
                <div mat-subheader>Activities</div>
                <mat-list-item *ngFor="let activity of drawer_activities">
                    <mat-icon mat-list-icon>fact_check</mat-icon>
                    <div mat-line style="max-width: 250px;">{{activity.info_activity_title}}</div>
                    <div mat-line> Event Date: {{activity.info_event_date | date}} </div>
                    <div mat-line> Asistance: {{activity.list_beneficiaries.length + 1 }} </div>
                </mat-list-item>
            </mat-list>


        </mat-card>

    </mat-drawer>
    <mat-drawer-content #draweContent>
        <div fxLayout="column">
            <div class="flex-p">
                <mat-toolbar>

                    <span>Beneficiaries Evaluation</span>

                </mat-toolbar>
                <ngx-datatable #myTable class="material expandable" [rows]="rows" [groupRowsBy]="'group_id'"
                    [columnMode]="ColumnMode.force" [scrollbarH]="true" [loadingIndicator]="showLoading"
                    [headerHeight]="50" [footerHeight]="50" [rowHeight]="45" [limit]="10"
                    [groupExpansionDefault]="false">
                    <!-- Group Header Template -->
                    <ngx-datatable-group-header [rowHeight]="50" #myGroupHeader (toggle)="onDetailToggle($event)">
                        <ng-template let-group="group" let-expanded="expanded" ngx-datatable-group-header-template>
                            <div style="height: 40px;" (click)="toggleGroup(group)">
                                <table style="width:520px;">
                                    <tr>
                                        <td style="width: 20px;">
                                            <span [class.datatable-icon-right]="!expanded"
                                                [class.datatable-icon-down]="expanded" title="Expand/Collapse Group">
                                            </span>
                                        </td>
                                        <td style="width: 50px;">
                                            ({{group.value.length}})
                                        </td>
                                        <td style="width: 150px;">
                                            {{group.value[0].ben_last_name1}}
                                        </td>
                                        <td style="width: 150px;">
                                            {{ group.value[0].ben_first_name }}
                                        </td>

                                        <td style="width: 100px;">
                                            <button class="mat-medium" *ngIf="expanded" mat-raised-button color="accent"
                                                (click)="saveMerge(group)" [disabled]="!saveEnabled">Save</button>
                                        </td>
                                        <td style="width: 150px;">
                                            <button class="mat-medium" *ngIf="expanded" mat-raised-button
                                                (click)="cancelMerge(group, $event)">Cancel</button>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </ng-template>
                    </ngx-datatable-group-header>

                    <!-- Row Column Template -->
                    <ngx-datatable-column [width]="150" name="Merge - Separate - Flag" prop="" editable="true"
                        frozenLeft="True">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row"
                            let-group="group">
                            <div class="datatable-checkbox merging">
                                <mat-checkbox id="merging{{rowIndex}}" name="{{ rowIndex }}" value="0"
                                    class="expectedpayment" (change)="checkGroup($event, row, rowIndex, group);"
                                    [(ngModel)]="row.merging" matTooltip="Merge"></mat-checkbox>
                            </div>

                            <div class="datatable-checkbox separating">
                                <mat-checkbox id="separating{{rowIndex}}" name="{{ rowIndex }}" value="1"
                                    class="expectedpayment2" (change)="checkGroup($event, row, rowIndex, group);"
                                    [(ngModel)]="row.separating" matTooltip="Separate"></mat-checkbox>
                            </div>

                            <div class="datatable-checkbox flagging">
                                <mat-checkbox id="flagging{{rowIndex}}" name="{{ rowIndex }}" value="2"
                                    class="expectedpayment3" (change)="checkGroup($event, row, rowIndex, group);"
                                    [(ngModel)]="row.flagging" matTooltip="Flag"></mat-checkbox>
                            </div>
                        </ng-template>
                    </ngx-datatable-column>

                    <ngx-datatable-column [width]="120" name="First Name" prop="ben_first_name" editable="false"
                        frozenLeft="True">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row"
                            let-group="group" let-rowHeight="rowHeight">
                            <span *ngIf="!isEditable[rowIndex]"> {{value}} </span>
                            <input *ngIf="isEditable[rowIndex]" style="width: 95%;"
                                (blur)="updateValue($event, 'ben_first_name', rowIndex)" type="text"
                                name="ben_first_name" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column [width]="120" name="Middle Name" prop="ben_middle_name" editable="true"
                        frozenLeft="True">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row"
                            let-group="group" let-rowHeight="rowHeight">
                            <span *ngIf="!isEditable[rowIndex]"> {{value}} </span>
                            <input *ngIf="isEditable[rowIndex]" style="width: 95%;"
                                (blur)="updateValue($event, 'ben_middle_name', rowIndex)" type="text"
                                name="ben_middle_name" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column [width]="120" name="1st Last Name" prop="ben_last_name1" editable="true"
                        frozenLeft="True">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row"
                            let-group="group" let-rowHeight="rowHeight">
                            <span *ngIf="!isEditable[rowIndex]"> {{value}} </span>
                            <input *ngIf="isEditable[rowIndex]" style="width: 95%;"
                                (blur)="updateValue($event, 'ben_last_name1', rowIndex)" type="text"
                                name="ben_last_name1" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column [width]="120" name="2nd Last Name" prop="ben_last_name2" editable="true"
                        frozenLeft="True">
                        <ng-template ngx-datatable-cell-template let-rowIndex="rowIndex" let-value="value" let-row="row"
                            let-group="group" let-rowHeight="rowHeight">
                            <span *ngIf="!isEditable[rowIndex]"> {{value}} </span>
                            <input *ngIf="isEditable[rowIndex]" style="width: 95%;"
                                (blur)="updateValue($event, 'ben_last_name2', rowIndex)" type="text"
                                name="ben_last_name2" [value]="value" />
                        </ng-template>
                    </ngx-datatable-column>
                    <ngx-datatable-column [width]="90" name="Gender" prop="ben_sex"></ngx-datatable-column>
                    <ngx-datatable-column [width]="90" name="Birthday" prop="ben_birthday"></ngx-datatable-column>
                    <ngx-datatable-column [width]="40" name="Age" prop="age"></ngx-datatable-column>
                    <ngx-datatable-column [width]="100" name="Type" prop="ben_beneficiary_type"> </ngx-datatable-column>
                    <ngx-datatable-column [width]="300" name="Community" prop="ben_community"></ngx-datatable-column>
                    <ngx-datatable-column [width]="225" name="Actions" frozenRight="True">
                        <ng-template ngx-datatable-cell-template let-row="row" let-rowIndex="rowIndex">
                            <!-- <button class="mat-small" mat-raised-button color="accent"
                                (click)="this.isEditable[rowIndex]=!this.isEditable[rowIndex]">
                                {{ !isEditable[rowIndex] ? 'Edit' : 'Save' }}
                            </button> -->
                            <span class="spacer"></span>
                            <button class="mat-small" mat-raised-button color="primary"
                                (click)="openDrawerActivities(row)"> Show Activities</button>
                        </ng-template>
                    </ngx-datatable-column>
                </ngx-datatable>
            </div>
        </div>
    </mat-drawer-content>
</mat-drawer-container>